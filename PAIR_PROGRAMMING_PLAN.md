# Pair Programming Backend: Revised Implementation Plan

## Plan
This app is for matching registered users (2 unique users) for pair programming.

### 1. User and Pairing Tracking
- Store users and their previous pairings in MongoDB.
- Each user document should include: name, email, and a list of user IDs they have already been paired with.

### 2. API Endpoints
- Use FastAPI to define endpoints.
- POST `/register`: Accepts name and email, adds user if not present, and pairs them with a new user they haven’t been matched with.
- POST `/pair`: It accepts username or email and responds by emailing who the user has been paired with and a message.
- GET `/users`: List all users and their pairings for admin/debugging.

### 3. Pairing Logic
- When a user registers, find another user they haven’t been paired with.
- Update both users’ pairing history in MongoDB.
- If all possible pairings are exhausted, return an appropriate message.

### 4. Email Notification
- Use the Gov Notify service to send emails. (pairpeople@notifications.service.gov.uk)
- Use a library like `smtplib` or a transactional email service (e.g., SendGrid) to send emails.
- The email must be sent using outlook.
- After pairing, send an email to both users with their match details.

### 5. MongoDB Integration
- Use `pymongo` to connect to MongoDB.
- Store users and pairings in a collection (e.g., `users`).
- MongoDB connecting information is in the compose.yml.

### 6. HTTP Client
- Use `httpx` for any outbound HTTP requests (e.g., if integrating with an external email API).

### 7. Testing
- Write integration tests using `pytest` and `httpx.AsyncClient` for FastAPI.
- Document API endpoints for use with Postman (OpenAPI docs are auto-generated by FastAPI).

---

## Implementation Steps
1. **Set up MongoDB connection** in a shared module (see `app/common/mongo.py` for existing setup).
2. **Define Pydantic models** for user input and output.
3. **Implement FastAPI endpoints** in `main.py` or a new router.
4. **Implement pairing logic** that checks MongoDB for previous pairings.
5. **Send email notifications** after successful pairing.
6. **Write tests** for endpoints and pairing logic.
7. **Document API** for Postman (FastAPI auto-generates `/docs`).

---

## Example MongoDB User Document
```json
{
  "name": "Alice",
  "email": "alice@example.com",
  "paired_with": ["user_id_1", "user_id_2"]
}
```

---

## Next Steps
- Refactor your code to use FastAPI and MongoDB.
- Implement the pairing logic as described.
- Add email sending functionality.
- Write tests and use FastAPI’s `/docs` for Postman testing.
